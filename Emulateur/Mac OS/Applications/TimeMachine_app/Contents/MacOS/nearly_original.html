<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
		<title>3D World Creator</title>
		<meta name="GENERATOR" content="Microsoft Visual Studio .NET 7.1">
	</head>
	<body onload="Debug(); init();" bgcolor="black" text="white">
	<style>
		.actionbutton
			{
				font-size:20px;
			}
		.actionbutton 
			A
			{
				color:skyblue;
				TEXT-DECORATION: none;
			}
		.actionbutton 
			A:hover
			{
				TEXT-DECORATION: none;
				color:red;
			}
	
	</style>
<div id="mainscreen" style="position:absolute; z-Index:0; left:0; top:0; overflow:hidden; width:100%; height:100%;">

</div>
<div style="position:relative; z-Index:100000; width:0">
<!--div id="mainscreen" style="overflow:hidden; width:100%; height:100%; position:relative"-->
	<!--/div> 
	<div style="position:absolute; z-index:100000; width:100%"-->
		<span style="position:relative; z-index:100000">

		<textarea id=world3txt rows=10 cols=50 style="filter:alpha(opacity=70); -moz-opacity:.7; display:none" wrap=off onfocus="this.select()">
		</textarea><br><br>
		
		<font face="Verdana" size="1">movement:</font><br>
		<table class=actionbutton cellspacing=0 cellpadding=0>
			<tr>
			<td align=center>
			<font face="Webdings">
				<a href="#" onmousedown="hmov=-.02*world3.hscale; return false;" onmouseup="hmov=0; redraw();">5</a><br>

				m<br>
				<a href="#" onmousedown="hmov=.02*world3.hscale; return false;" onmouseup="hmov=0; redraw();">6</a>
			</font>
			</td>
			<td align=center>
			<font face="Webdings">
				<a href="#" onmousedown="ymov=-.02*world3.yscale; return false;" onmouseup="ymov=0; redraw();">5</a><br>

				<nobr>
				<a href="#" onmousedown="xmov=.02*world3.xscale; return false;" onmouseup="xmov=0; redraw();">3</a>
				<a href="#" onmousedown="xmov=-.02*world3.xscale; return false;" onmouseup="xmov=0; redraw();">4</a>
				</nobr>
				<br>
				<a href="#" onmousedown="ymov=.02*world3.yscale; return false;" onmouseup="ymov=0; redraw();">6</a>
			</font>

			</td>
			<td align=center>
			<font face="Webdings">
				<a href="#" onmousedown="slopemov=-.001; return false;" onmouseup="slopemov=0; redraw();">5</a><br>
				N<br>
				<a href="#" onmousedown="slopemov=.001; return false;" onmouseup="slopemov=0; redraw();">6</a>
			</font>

			</td>
			</tr>
		</table>
		<font face="Verdana" size="1">scale:
		<table class=actionbutton  cellspacing=0 cellpadding=0>
			<tr><td>
				<font face="Courier">
				<nobr>x  <a href="#" onmousedown="xscalemov=.001; return false;" onmouseup="xscalemov=0; redraw();">+</a> <a href="#" onmousedown="xscalemov=-.001; return false;" onmouseup="xscalemov=0; redraw();">-</a></nobr><br>

				<nobr>y  <a href="#" onmousedown="yscalemov=.001; return false;" onmouseup="yscalemov=0; redraw();">+</a> <a href="#" onmousedown="yscalemov=-.001; return false;" onmouseup="yscalemov=0; redraw();">-</a></nobr><br>
				<nobr>h  <a href="#" onmousedown="hscalemov=.001; return false;" onmouseup="hscalemov=0; redraw();">+</a> <a href="#" onmousedown="hscalemov=-.001; return false;" onmouseup="hscalemov=0; redraw();">-</a></nobr>
				</font>
			</td>
			</tr>

		</table>
		<br>
		<nobr>
		<button style="width:80; height:50"  value="addImage" type="button" onclick="addImage(); redraw();">Add new	<br> image</button>
		<button style="width:80; height:50"  value="removeImage" type="button" onclick="removeImg(); redraw();">Remove <br> image </button>
		</nobr>

		<br>
		
		<button style="width:80"  value="bounce" type="button" onclick="bounceImg(); redraw()">bounce</button>
		
		<!--button value="angle+" type="button" onclick="world3.angle+=Math.PI/20; redraw();">angle+</button>
		<button value="angle-" type="button" onclick="world3.angle-=Math.PI/20; redraw();">angle-</button-->
		</span>
</div>
		<script language="javascript" src="3d.js"></script>
		<script language="javascript" src="sprite3.js"></script>
		<script language="javascript" src="wall3.js"></script>

		<script language="javascript">

////////////////////////////////////////////////////////////////
// 
// 3dworld.html
//
// Copyright (c) 2006 (Vinh Le Quang). 
// http://www.bunnypot.com/3dworld/
// You may copy or reuse this code only if you include this copyright notice.
// Send comments to kwanguru@yahoo.com
//
////////////////////////////////////////////////////////////////



var xcount = 5;
var ycount = 5;
var hcount = 5;
var selection = null;
var drag = false;

var floor = new Array(xcount*ycount);
var leftwall = new Array(hcount*ycount);
var rightwall = new Array(hcount*ycount);
//var farwall = new Array(100);
var spriteslist = new Array(floor,leftwall,rightwall);
//var farwall = new Sprite3();

function init()
{
world3.hscale = .5;
world3.yscale = .3;
//redrawAll();	
/*	for(var s=0;s<spriteslist.length;s++)
	{
		var sprites = spriteslist[s];
		for(var i=0;i<sprites.length;i++)
		{
			sprites[i] = new Sprite3();
			sprites[i].addImage(s==0?"shadow.gif":s==3?"farwall.gif":"column.gif",20,30,false,100,null,null);
		}
	}
	farwall.addImage("farwall.gif",100,100,false,100,null,null);
	setPosition();
*/
//	var westwall = new Wall3(0,0,0,100);
//	var eastwall = new Wall3(100,0,100,100);
//	var northwall = new Wall3(0,100,100,100);
//	var southwall = new Wall3(0,0,100,0);
	var step = 25;
	for(var i=0;i<100;i+=step)	
	{
		var westwall = new Wall3(0,i,0,i+step,16711680,true);
		var eastwall = new Wall3(100,i,100,i+step,16711680,true);
//		var northwall = new Wall3(i,100,i+step,100,16711680);
//		var southwall = new Wall3(i,-50,i+step,-50,16711680);
	}
	var northwall = new Wall3(0,100,100,100,16711680,true);
	
	var mia = quickSprite("mia.gif",0,100,false,100);
	mia.imgs[0].onmousedown = ondragimg;
	mia.moveTo(0,1,0);

	var ball = quickSprite("ball.gif",0,20,true,100);
	ball.imgs[0].onmousedown = ondragimg;
	ball.moveTo(90,80,0);
	ball.setMotion(0,0,.1);
	ball.gravity = .0001;
	
	redraw();
	startGame();
}

function ondragimg()
{
	if(selection)
		selection.imgs[0].style.backgroundColor = "";
	selection=this.sprite;
	selection.imgs[0].style.backgroundColor = "silver";
	drag = true;

//	alert(this.sprite);
	return false;
}

function setPosition()
{
	for(var s=0;s<spriteslist.length;s++)
	{
		var sprites = spriteslist[s];
		for(var i=0;i<sprites.length;i++)
		{
			var x = s==1?0:s==2?100:(i%xcount)*(100/xcount);
			var y = s==1||s==2?(i%ycount)*(100/ycount):s==3?100:Math.floor(i/xcount)%(ycount)*(100/ycount);
			var h = s==0?0:Math.floor(i/ycount)%hcount*(100/hcount);
			sprites[i].moveTo(x,y,h);
		}	
	}
	farwall.moveTo(50,100,0);
}

function format(number)
{
	return Math.round(10*number)/10;
}

window.redraw = window.onresize = function ()
{

	redrawAll();
	var str = unescape("%3C%21-- cut and paste the HTML below in your page --%3E\n\n");
	str += unescape("%3Cscript src%3D%22http%3A//www.bunnypot.com/library/3d.js%22%3E");
	str += unescape("%3C/script%3E\n");
	str += unescape("%3Cscript src%3D%22http%3A//www.bunnypot.com/library/sprite3.js%22%3E");
	str += unescape("%3C/script%3E\n");
	str += unescape("%3Cscript language%3D%22javascript%22%3E");
	str += "\n\n";
	str += "function init()\n";
	str += "{\n";
	str += world3 + "\n";
	
	for(var i=0;i<world3.sprites.length;i++)
	{
		var sprite = world3.sprites[i];
		if(!sprite.dead && sprite.imgs!=null && sprite.imgs.length>0)
		{
			if(sprite.imgs.length>1)
			{
				str += '{var sprite = new Sprite3();\n';
				for(var j=0;j<sprite.imgs.length;j++)
				{
					var img = sprite.imgs[j];
					str += 'sprite.addImage(getrealsrc("' + filename(img.src) + '"),' + img.originalwidth + ',' + img.originalheight + ',' + (img.shadow?'true':'false') + ',100,null,null)\n';
				}
				str += 'sprite.moveTo(' + format(sprite.x3) + ',' + format(sprite.y3) + ',' + format(sprite.h3) + ')';
				if(sprite.mov)
				{
					str += '.setMotion(' + sprite.mov.x3 + ',' + sprite.mov.y3 + ',' + sprite.mov.h3 + ',' + sprite.gravity + ')';
				}
				str += ";\n}\n";
			}
			else
			{
				var img = sprite.imgs[0];
				str += 'quickSprite("' + filename(img.src) + '",' + img.originalwidth + ',' + img.originalheight + ',' + (img.shadow?'true':'false') + ',100)';
				str += '.moveTo(' + format(sprite.x3) + ',' + format(sprite.y3) + ',' + format(sprite.h3) + ')';
				if(sprite.mov)
				{
					str += '.setMotion(' + sprite.mov.x3 + ',' + sprite.mov.y3 + ',' + sprite.mov.h3 + ',' + sprite.gravity + ')';
				}
				str += ";\n";
			}
		}
	}
	
	str += "\n";
	str += "startGame();\n";
	str += "}\n";
	str += "window.onload=init;\n";
	
	str += "\n";
	
	str += refresh.toString().replace(/\t/g,"").replace(/\s/g," ") + "\n";
	
	str += unescape("%3C/script%3E\n");
	str += unescape("%3Cdiv%20id%3D%22mainscreen%22%20style%3D%22position%3Aabsolute%3B%20left%3A0%3B%20top%3A0%3B%20overflow%3Ahidden%3B%20width%3A100%25%3B%20height%3A100%25%3B%22%3E%3C/div%3E\n");
	str += unescape("%3C%21-- the 3d was generated by 3D World Creator (http://www.bunnypot.com/3dworld) --%3E\n\n");
	str += unescape("%3C%21-- send your comments to Vinh Le Quang (kwanguru@yahoo.com) --%3E\n\n");
	world3txt.value = str;
//	displayWall3(0,0,0,100,100,"red");
//	displayWall3bis(100,0,100,100,100,"red");
};

function screen2XY(scrx,scry,target)
{
	var h3,y3,x3;
	var middlescreen = mainscreen.offsetWidth/2;
	
	y3 = Math.max(0,Math.min(100,-20 + 10000/scry));
	x3 = Math.max(0,Math.min(100,50+(scrx-middlescreen)*y3/100));
	h3 = 0;
	
	if(!target)
		target = new Point3(x3,y3,h3);
	else
		target.setPoint(x3,y3,h3);
	return target;
}

var prexy = new Point2(0,0);
document.onmousemove = function /*document.onmousemove*/(e)
{
	if(!e)
		e = window.event;
	var scrx = e.clientX;
	var scry = e.clientY + world3.top;
	var xdiff = scrx-prexy.x2;
	var ydiff = scry-prexy.y2;
	prexy.setPoint(scrx,scry);
	
	if(selection && drag)
	{
		selection.moveTo(selection.x3 + xdiff,selection.y3 - ydiff,selection.h3);
		
//		var point = screen2XY(scrx,scry);
	//	selection.moveTo(point.x3,point.y3,point.h3);
		redraw();
	}
	return false;
};

document.onmouseup = function (e)
{
	drag = false;
	if(selection)
	{
//		selection.imgs[0].style.backgroundColor = "";
//		selection = null;
	}
	return false;
};

function bounceImg()
{
	if(selection)
	{
		selection.setMotion(0,0,.1);
		selection.gravity = .0001;
	}
}

function removeImg()
{
	if(selection)
	{
		for(var i=0;i<selection.imgs.length;i++)
		{
			selection.imgs[i].style.display = "none";
			if(selection.imgs[i].shadow)
			{
				selection.imgs[i].shadow.style.display = "none";
			}
		}
		selection.dead = true;
		selection = null;
	}
}

function addImage()
{
	var src = prompt("Enter the image URL","");
	if(!src || src=="")
		return;
	var size = prompt("Enter the image height",50);
	if(!size)
		return;
	var sprite = quickSprite(src,0,parseInt(size),false,100);
	sprite.imgs[0].onmousedown = ondragimg;	
	
	
	
}

var xmov = 0, ymov = 0, hmov = 0, slopemov = 0;
var xscalemov = 0, yscalemov = 0, hscalemov = 0;
function refresh(duration)
{
	if(xmov != 0 || ymov!=0 || hmov!=0 || slopemov!=0 || xscalemov!=0 || yscalemov!=0 || hscalemov!=0)
	{
		world3.xstart += xmov*duration;
		world3.ystart += ymov*duration;
		world3.hstart += hmov*duration;
		world3.slope += slopemov*duration;
		world3.xscale += xscalemov*duration;
		world3.yscale += yscalemov*duration;
		world3.hscale += hscalemov*duration;
		dirtyAll();
	}
	for(var i=0;i<world3.mobiles.length;i++)
	{
		world3.mobiles[i].move(duration);
		if(world3.mobiles[i].h3<0)
		{
			world3.mobiles[i].h3=-world3.mobiles[i].h3;
			world3.mobiles[i].mov.h3 = .1;
		}
	}
}

/*
function displayWall3(x3start,y3start,x3finish,y3finish,h3,color)
{
	var p2topstart = new Point3(x3start,y3start,h3).convertToScreen();
	var p2topfinish = new Point3(x3finish,y3finish,h3).convertToScreen();
	var p2botstart = new Point3(x3start,y3start,0).convertToScreen();
	var p2botfinish = new Point3(x3finish,y3finish,0).convertToScreen();

//	alert(p3topstart.convertToScreen());
	if(p2topstart.y2<p2topfinish.y2)
	{
		tl.style.backgroundColor = color;
		display2D(tl,p2topstart,p2topfinish);
	}
	
	cn.style.backgroundColor = color;
	display2D(cn,new Point2(p2topstart.x2,p2topfinish.y2),new Point2(p2botfinish.x2,p2botfinish.y2));

	bl.style.backgroundColor = color;
	display2D(bl,p2botstart,p2botfinish);
}

function displayWall3bis(x3start,y3start,x3finish,y3finish,h3,color)
{
	var p2topstart = new Point3(x3start,y3start,h3).convertToScreen();
	var p2topfinish = new Point3(x3finish,y3finish,h3).convertToScreen();
	var p2botstart = new Point3(x3start,y3start,0).convertToScreen();
	var p2botfinish = new Point3(x3finish,y3finish,0).convertToScreen();

//	alert(p3topstart.convertToScreen());
	if(p2topstart.y2<p2topfinish.y2)
	{
		tr.style.backgroundColor = color;
		display2D(tr,p2topstart,p2topfinish);
	}
	
	cn2.style.backgroundColor = color;
	display2D(cn2,new Point2(p2topstart.x2,p2topfinish.y2),new Point2(p2botfinish.x2,p2botfinish.y2));

	br.style.backgroundColor = color;
	display2D(br,p2botstart,p2botfinish);
}
*/

function Debug()
{
}

		</script>
			<span style="display:none">
				<img src="mia.gif" onload="preload(this)">
			</span>
		
	</body>
</html>
